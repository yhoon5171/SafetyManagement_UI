{"ast":null,"code":"'use strict';\n\nvar _regeneratorRuntime = require(\"D:/\\uACF5\\uD504\\uAE30/Capstone test/SafetyManagement_UI/client/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\n\nvar _objectSpread = require(\"D:/\\uACF5\\uD504\\uAE30/Capstone test/SafetyManagement_UI/client/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\n\nvar _asyncToGenerator = require(\"D:/\\uACF5\\uD504\\uAE30/Capstone test/SafetyManagement_UI/client/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nvar _asyncIterator = require(\"D:/\\uACF5\\uD504\\uAE30/Capstone test/SafetyManagement_UI/client/node_modules/@babel/runtime/helpers/asyncIterator.js\").default;\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar debug = require('debug');\n\nvar configure = require('../lib/configure.js');\n\nvar toUrlSearchParams = require('../lib/to-url-search-params.js');\n\nvar httpRpcWireFormat = require('../lib/http-rpc-wire-format.js');\n\nfunction _interopDefaultLegacy(e) {\n  return e && typeof e === 'object' && 'default' in e ? e : {\n    'default': e\n  };\n}\n\nvar debug__default = /*#__PURE__*/_interopDefaultLegacy(debug);\n\nvar log = debug__default[\"default\"]('ipfs-http-client:pubsub:subscribe');\n\nvar createSubscribe = function createSubscribe(options, subsTracker) {\n  return configure.configure(function (api) {\n    function subscribe(_x, _x2) {\n      return _subscribe.apply(this, arguments);\n    }\n\n    function _subscribe() {\n      _subscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(topic, handler) {\n        var options,\n            done,\n            fail,\n            result,\n            ffWorkaround,\n            _args = arguments;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                options = _args.length > 2 && _args[2] !== undefined ? _args[2] : {};\n                options.signal = subsTracker.subscribe(topic, handler, options.signal);\n                result = new Promise(function (resolve, reject) {\n                  done = resolve;\n                  fail = reject;\n                });\n                ffWorkaround = setTimeout(function () {\n                  return done();\n                }, 1000);\n                api.post('pubsub/sub', {\n                  signal: options.signal,\n                  searchParams: toUrlSearchParams.toUrlSearchParams(_objectSpread({\n                    arg: httpRpcWireFormat.textToUrlSafeRpc(topic)\n                  }, options)),\n                  headers: options.headers\n                }).catch(function (err) {\n                  subsTracker.unsubscribe(topic, handler);\n                  fail(err);\n                }).then(function (response) {\n                  clearTimeout(ffWorkaround);\n\n                  if (!response) {\n                    return;\n                  }\n\n                  readMessages(response, {\n                    onMessage: handler,\n                    onEnd: function onEnd() {\n                      return subsTracker.unsubscribe(topic, handler);\n                    },\n                    onError: options.onError\n                  });\n                  done();\n                });\n                return _context.abrupt(\"return\", result);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _subscribe.apply(this, arguments);\n    }\n\n    return subscribe;\n  })(options);\n};\n\nfunction readMessages(_x3, _x4) {\n  return _readMessages.apply(this, arguments);\n}\n\nfunction _readMessages() {\n  _readMessages = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(response, _ref) {\n    var onMessage, onEnd, onError, _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, msg;\n\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            onMessage = _ref.onMessage, onEnd = _ref.onEnd, onError = _ref.onError;\n            onError = onError || log;\n            _context2.prev = 2;\n            _iteratorAbruptCompletion = false;\n            _didIteratorError = false;\n            _context2.prev = 5;\n            _iterator = _asyncIterator(response.ndjson());\n\n          case 7:\n            _context2.next = 9;\n            return _iterator.next();\n\n          case 9:\n            if (!(_iteratorAbruptCompletion = !(_step = _context2.sent).done)) {\n              _context2.next = 24;\n              break;\n            }\n\n            msg = _step.value;\n            _context2.prev = 11;\n\n            if (msg.from) {\n              _context2.next = 14;\n              break;\n            }\n\n            return _context2.abrupt(\"continue\", 21);\n\n          case 14:\n            onMessage({\n              from: msg.from,\n              data: httpRpcWireFormat.rpcToBytes(msg.data),\n              seqno: httpRpcWireFormat.rpcToBytes(msg.seqno),\n              topicIDs: httpRpcWireFormat.rpcArrayToTextArray(msg.topicIDs)\n            });\n            _context2.next = 21;\n            break;\n\n          case 17:\n            _context2.prev = 17;\n            _context2.t0 = _context2[\"catch\"](11);\n            _context2.t0.message = \"Failed to parse pubsub message: \".concat(_context2.t0.message);\n            onError(_context2.t0, false, msg);\n\n          case 21:\n            _iteratorAbruptCompletion = false;\n            _context2.next = 7;\n            break;\n\n          case 24:\n            _context2.next = 30;\n            break;\n\n          case 26:\n            _context2.prev = 26;\n            _context2.t1 = _context2[\"catch\"](5);\n            _didIteratorError = true;\n            _iteratorError = _context2.t1;\n\n          case 30:\n            _context2.prev = 30;\n            _context2.prev = 31;\n\n            if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n              _context2.next = 35;\n              break;\n            }\n\n            _context2.next = 35;\n            return _iterator.return();\n\n          case 35:\n            _context2.prev = 35;\n\n            if (!_didIteratorError) {\n              _context2.next = 38;\n              break;\n            }\n\n            throw _iteratorError;\n\n          case 38:\n            return _context2.finish(35);\n\n          case 39:\n            return _context2.finish(30);\n\n          case 40:\n            _context2.next = 45;\n            break;\n\n          case 42:\n            _context2.prev = 42;\n            _context2.t2 = _context2[\"catch\"](2);\n\n            if (!isAbortError(_context2.t2)) {\n              onError(_context2.t2, true);\n            }\n\n          case 45:\n            _context2.prev = 45;\n            onEnd();\n            return _context2.finish(45);\n\n          case 48:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[2, 42, 45, 48], [5, 26, 30, 40], [11, 17], [31,, 35, 39]]);\n  }));\n  return _readMessages.apply(this, arguments);\n}\n\nvar isAbortError = function isAbortError(error) {\n  switch (error.type) {\n    case 'aborted':\n      return true;\n\n    case 'abort':\n      return true;\n\n    default:\n      return error.name === 'AbortError';\n  }\n};\n\nexports.createSubscribe = createSubscribe;","map":{"version":3,"names":["Object","defineProperty","exports","value","debug","require","configure","toUrlSearchParams","httpRpcWireFormat","_interopDefaultLegacy","e","debug__default","log","createSubscribe","options","subsTracker","api","subscribe","topic","handler","signal","result","Promise","resolve","reject","done","fail","ffWorkaround","setTimeout","post","searchParams","arg","textToUrlSafeRpc","headers","catch","err","unsubscribe","then","response","clearTimeout","readMessages","onMessage","onEnd","onError","ndjson","msg","from","data","rpcToBytes","seqno","topicIDs","rpcArrayToTextArray","message","isAbortError","error","type","name"],"sources":["D:/공프기/Capstone test/SafetyManagement_UI/client/node_modules/ipfs-http-client/cjs/src/pubsub/subscribe.js"],"sourcesContent":["'use strict';\r\n\r\nObject.defineProperty(exports, '__esModule', { value: true });\r\n\r\nvar debug = require('debug');\r\nvar configure = require('../lib/configure.js');\r\nvar toUrlSearchParams = require('../lib/to-url-search-params.js');\r\nvar httpRpcWireFormat = require('../lib/http-rpc-wire-format.js');\r\n\r\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\r\n\r\nvar debug__default = /*#__PURE__*/_interopDefaultLegacy(debug);\r\n\r\nconst log = debug__default[\"default\"]('ipfs-http-client:pubsub:subscribe');\r\nconst createSubscribe = (options, subsTracker) => {\r\n  return configure.configure(api => {\r\n    async function subscribe(topic, handler, options = {}) {\r\n      options.signal = subsTracker.subscribe(topic, handler, options.signal);\r\n      let done;\r\n      let fail;\r\n      const result = new Promise((resolve, reject) => {\r\n        done = resolve;\r\n        fail = reject;\r\n      });\r\n      const ffWorkaround = setTimeout(() => done(), 1000);\r\n      api.post('pubsub/sub', {\r\n        signal: options.signal,\r\n        searchParams: toUrlSearchParams.toUrlSearchParams({\r\n          arg: httpRpcWireFormat.textToUrlSafeRpc(topic),\r\n          ...options\r\n        }),\r\n        headers: options.headers\r\n      }).catch(err => {\r\n        subsTracker.unsubscribe(topic, handler);\r\n        fail(err);\r\n      }).then(response => {\r\n        clearTimeout(ffWorkaround);\r\n        if (!response) {\r\n          return;\r\n        }\r\n        readMessages(response, {\r\n          onMessage: handler,\r\n          onEnd: () => subsTracker.unsubscribe(topic, handler),\r\n          onError: options.onError\r\n        });\r\n        done();\r\n      });\r\n      return result;\r\n    }\r\n    return subscribe;\r\n  })(options);\r\n};\r\nasync function readMessages(response, {onMessage, onEnd, onError}) {\r\n  onError = onError || log;\r\n  try {\r\n    for await (const msg of response.ndjson()) {\r\n      try {\r\n        if (!msg.from) {\r\n          continue;\r\n        }\r\n        onMessage({\r\n          from: msg.from,\r\n          data: httpRpcWireFormat.rpcToBytes(msg.data),\r\n          seqno: httpRpcWireFormat.rpcToBytes(msg.seqno),\r\n          topicIDs: httpRpcWireFormat.rpcArrayToTextArray(msg.topicIDs)\r\n        });\r\n      } catch (err) {\r\n        err.message = `Failed to parse pubsub message: ${ err.message }`;\r\n        onError(err, false, msg);\r\n      }\r\n    }\r\n  } catch (err) {\r\n    if (!isAbortError(err)) {\r\n      onError(err, true);\r\n    }\r\n  } finally {\r\n    onEnd();\r\n  }\r\n}\r\nconst isAbortError = error => {\r\n  switch (error.type) {\r\n  case 'aborted':\r\n    return true;\r\n  case 'abort':\r\n    return true;\r\n  default:\r\n    return error.name === 'AbortError';\r\n  }\r\n};\r\n\r\nexports.createSubscribe = createSubscribe;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}