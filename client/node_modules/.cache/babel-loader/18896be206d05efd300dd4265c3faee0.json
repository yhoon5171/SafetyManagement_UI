{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decode = exports.encode = exports.toGeneral = exports.code = exports.name = void 0;\n\nconst signing_1 = __importDefault(require(\"./signing\"));\n\nconst encryption_1 = __importDefault(require(\"./encryption\"));\n\nconst cbor = __importStar(require(\"@ipld/dag-cbor\"));\n\nexports.name = 'dag-jose';\nexports.code = 133;\n\nfunction isDagJWS(jose) {\n  return 'payload' in jose && typeof jose.payload === 'string' && 'signatures' in jose && Array.isArray(jose.signatures);\n}\n\nfunction isEncodedJWS(jose) {\n  return 'payload' in jose && jose.payload instanceof Uint8Array && 'signatures' in jose && Array.isArray(jose.signatures);\n}\n\nfunction isEncodedJWE(jose) {\n  return 'ciphertext' in jose && jose.ciphertext instanceof Uint8Array && 'iv' in jose && jose.iv instanceof Uint8Array && 'protected' in jose && jose.protected instanceof Uint8Array && 'tag' in jose && jose.tag instanceof Uint8Array;\n}\n\nfunction isDagJWE(jose) {\n  return 'ciphertext' in jose && typeof jose.ciphertext === 'string' && 'iv' in jose && typeof jose.iv === 'string' && 'protected' in jose && typeof jose.protected === 'string' && 'tag' in jose && typeof jose.tag === 'string';\n}\n\nfunction toGeneral(jose) {\n  if (typeof jose === 'string') {\n    const split = jose.split('.');\n\n    if (split.length === 3) {\n      return signing_1.default.fromSplit(split);\n    } else if (split.length === 5) {\n      return encryption_1.default.fromSplit(split);\n    }\n\n    throw new Error('Not a valid JOSE string');\n  }\n\n  if (isDagJWS(jose) || isDagJWE(jose)) {\n    return jose;\n  }\n\n  throw new Error('Not a valid unencoded JOSE object');\n}\n\nexports.toGeneral = toGeneral;\n\nfunction encode(obj) {\n  if (typeof obj === 'string') {\n    obj = toGeneral(obj);\n  }\n\n  let encodedJose;\n\n  if (isDagJWS(obj)) {\n    encodedJose = signing_1.default.encode(obj);\n  } else if (isDagJWE(obj)) {\n    encodedJose = encryption_1.default.encode(obj);\n  } else {\n    throw new Error('Not a valid JOSE object');\n  }\n\n  return new Uint8Array(cbor.encode(encodedJose));\n}\n\nexports.encode = encode;\n\nfunction decode(data) {\n  let encoded;\n\n  try {\n    encoded = cbor.decode(data);\n  } catch (e) {\n    throw new Error('Not a valid DAG-JOSE object');\n  }\n\n  if (isEncodedJWS(encoded)) {\n    return signing_1.default.decode(encoded);\n  } else if (isEncodedJWE(encoded)) {\n    return encryption_1.default.decode(encoded);\n  } else {\n    throw new Error('Not a valid DAG-JOSE object');\n  }\n}\n\nexports.decode = decode;","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.decode = exports.encode = exports.toGeneral = exports.code = exports.name = void 0;\r\nconst signing_1 = __importDefault(require(\"./signing\"));\r\nconst encryption_1 = __importDefault(require(\"./encryption\"));\r\nconst cbor = __importStar(require(\"@ipld/dag-cbor\"));\r\nexports.name = 'dag-jose';\r\nexports.code = 133;\r\nfunction isDagJWS(jose) {\r\n    return ('payload' in jose &&\r\n        typeof jose.payload === 'string' &&\r\n        'signatures' in jose &&\r\n        Array.isArray(jose.signatures));\r\n}\r\nfunction isEncodedJWS(jose) {\r\n    return ('payload' in jose &&\r\n        jose.payload instanceof Uint8Array &&\r\n        'signatures' in jose &&\r\n        Array.isArray(jose.signatures));\r\n}\r\nfunction isEncodedJWE(jose) {\r\n    return ('ciphertext' in jose &&\r\n        jose.ciphertext instanceof Uint8Array &&\r\n        'iv' in jose &&\r\n        jose.iv instanceof Uint8Array &&\r\n        'protected' in jose &&\r\n        jose.protected instanceof Uint8Array &&\r\n        'tag' in jose &&\r\n        jose.tag instanceof Uint8Array);\r\n}\r\nfunction isDagJWE(jose) {\r\n    return ('ciphertext' in jose &&\r\n        typeof jose.ciphertext === 'string' &&\r\n        'iv' in jose &&\r\n        typeof jose.iv === 'string' &&\r\n        'protected' in jose &&\r\n        typeof jose.protected === 'string' &&\r\n        'tag' in jose &&\r\n        typeof jose.tag === 'string');\r\n}\r\nfunction toGeneral(jose) {\r\n    if (typeof jose === 'string') {\r\n        const split = jose.split('.');\r\n        if (split.length === 3) {\r\n            return signing_1.default.fromSplit(split);\r\n        }\r\n        else if (split.length === 5) {\r\n            return encryption_1.default.fromSplit(split);\r\n        }\r\n        throw new Error('Not a valid JOSE string');\r\n    }\r\n    if (isDagJWS(jose) || isDagJWE(jose)) {\r\n        return jose;\r\n    }\r\n    throw new Error('Not a valid unencoded JOSE object');\r\n}\r\nexports.toGeneral = toGeneral;\r\nfunction encode(obj) {\r\n    if (typeof obj === 'string') {\r\n        obj = toGeneral(obj);\r\n    }\r\n    let encodedJose;\r\n    if (isDagJWS(obj)) {\r\n        encodedJose = signing_1.default.encode(obj);\r\n    }\r\n    else if (isDagJWE(obj)) {\r\n        encodedJose = encryption_1.default.encode(obj);\r\n    }\r\n    else {\r\n        throw new Error('Not a valid JOSE object');\r\n    }\r\n    return new Uint8Array(cbor.encode(encodedJose));\r\n}\r\nexports.encode = encode;\r\nfunction decode(data) {\r\n    let encoded;\r\n    try {\r\n        encoded = cbor.decode(data);\r\n    }\r\n    catch (e) {\r\n        throw new Error('Not a valid DAG-JOSE object');\r\n    }\r\n    if (isEncodedJWS(encoded)) {\r\n        return signing_1.default.decode(encoded);\r\n    }\r\n    else if (isEncodedJWE(encoded)) {\r\n        return encryption_1.default.decode(encoded);\r\n    }\r\n    else {\r\n        throw new Error('Not a valid DAG-JOSE object');\r\n    }\r\n}\r\nexports.decode = decode;\r\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}