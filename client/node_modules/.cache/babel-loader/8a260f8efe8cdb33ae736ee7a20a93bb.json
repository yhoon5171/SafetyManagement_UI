{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\n\nconst abi_coder_1 = require(\"ethers/utils/abi-coder\");\n\nconst lodash_1 = __importDefault(require(\"lodash\"));\n\nexports.QuorumDefinition = {\n  initNetworkType(web3) {\n    return __awaiter(this, void 0, void 0, function* () {\n      // duck punch some of web3's output formatters\n      overrides.getBlock(web3);\n      overrides.getTransaction(web3);\n      overrides.getTransactionReceipt(web3);\n      overrides.decodeParameters(web3);\n    });\n  }\n\n};\nconst overrides = {\n  // The ts-ignores are ignoring the checks that are\n  // saying that web3.eth.getBlock is a function and doesn't\n  // have a `method` property, which it does\n  \"getBlock\": web3 => {\n    // @ts-ignore\n    const _oldBlockFormatter = web3.eth.getBlock.method.outputFormatter; // @ts-ignore\n\n    web3.eth.getBlock.method.outputFormatter = block => {\n      const _oldTimestamp = block.timestamp;\n      const _oldGasLimit = block.gasLimit;\n      const _oldGasUsed = block.gasUsed; // Quorum uses nanoseconds instead of seconds in timestamp\n\n      let timestamp = new bn_js_1.default(block.timestamp.slice(2), 16);\n      timestamp = timestamp.div(new bn_js_1.default(10).pow(new bn_js_1.default(9)));\n      block.timestamp = \"0x\" + timestamp.toString(16); // Since we're overwriting the gasLimit/Used later,\n      // it doesn't matter what it is before the call\n      // The same applies to the timestamp, but I reduced\n      // the precision since there was an accurate representation\n      // We do this because Quorum can have large block/transaction\n      // gas limits\n\n      block.gasLimit = \"0x0\";\n      block.gasUsed = \"0x0\"; // @ts-ignore\n\n      let result = _oldBlockFormatter.call(web3.eth.getBlock.method, block); // Perhaps there is a better method of doing this,\n      // but the raw hexstrings work for the time being\n\n\n      result.timestamp = _oldTimestamp;\n      result.gasLimit = _oldGasLimit;\n      result.gasUsed = _oldGasUsed;\n      return result;\n    };\n  },\n  \"getTransaction\": web3 => {\n    const _oldTransactionFormatter = // @ts-ignore\n    web3.eth.getTransaction.method.outputFormatter; // @ts-ignore\n\n    web3.eth.getTransaction.method.outputFormatter = tx => {\n      const _oldGas = tx.gas;\n      tx.gas = \"0x0\";\n\n      let result = _oldTransactionFormatter.call( // @ts-ignore\n      web3.eth.getTransaction.method, tx); // Perhaps there is a better method of doing this,\n      // but the raw hexstrings work for the time being\n\n\n      result.gas = _oldGas;\n      return result;\n    };\n  },\n  \"getTransactionReceipt\": web3 => {\n    const _oldTransactionReceiptFormatter = // @ts-ignore\n    web3.eth.getTransactionReceipt.method.outputFormatter; // @ts-ignore\n\n    web3.eth.getTransactionReceipt.method.outputFormatter = receipt => {\n      const _oldGasUsed = receipt.gasUsed;\n      receipt.gasUsed = \"0x0\";\n\n      let result = _oldTransactionReceiptFormatter.call( // @ts-ignore\n      web3.eth.getTransactionReceipt.method, receipt); // Perhaps there is a better method of doing this,\n      // but the raw hexstrings work for the time being\n\n\n      result.gasUsed = _oldGasUsed;\n      return result;\n    };\n  },\n  // The primary difference between this decodeParameters function and web3's\n  // is that the 'Out of Gas?' zero/null bytes guard has been removed and any\n  // falsy bytes are interpreted as a zero value.\n  \"decodeParameters\": web3 => {\n    const _oldDecodeParameters = web3.eth.abi.decodeParameters;\n    const ethersAbiCoder = new abi_coder_1.AbiCoder((type, value) => {\n      if (type.match(/^u?int/) && !lodash_1.default.isArray(value) && (!lodash_1.default.isObject(value) || value.constructor.name !== \"BN\")) {\n        return value.toString();\n      }\n\n      return value;\n    }); // result method\n\n    function Result() {}\n\n    web3.eth.abi.decodeParameters = (outputs, bytes) => {\n      // if bytes is falsy, we'll pass 64 '0' bits to the ethers.js decoder.\n      // the decoder will decode the 64 '0' bits as a 0 value.\n      if (!bytes) bytes = \"0\".repeat(64);\n      const res = ethersAbiCoder.decode( //@ts-ignore 'mapTypes' not existing on type 'ABI'\n      web3.eth.abi.mapTypes(outputs), `0x${bytes.replace(/0x/i, \"\")}`); //@ts-ignore complaint regarding Result method\n\n      const returnValue = new Result();\n      returnValue.__length__ = 0;\n      outputs.forEach((output, i) => {\n        let decodedValue = res[returnValue.__length__];\n        decodedValue = decodedValue === \"0x\" ? null : decodedValue;\n        returnValue[i] = decodedValue; // @ts-ignore object not having name key\n\n        if (lodash_1.default.isObject(output) && output.name) {\n          // @ts-ignore object not having name key\n          returnValue[output.name] = decodedValue;\n        }\n\n        returnValue.__length__++;\n      });\n      return returnValue;\n    };\n  }\n};","map":{"version":3,"sources":["../lib/quorum-overloads.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\r\nconst abi_coder_1 = require(\"ethers/utils/abi-coder\");\r\nconst lodash_1 = __importDefault(require(\"lodash\"));\r\nexports.QuorumDefinition = {\r\n    initNetworkType(web3) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            // duck punch some of web3's output formatters\r\n            overrides.getBlock(web3);\r\n            overrides.getTransaction(web3);\r\n            overrides.getTransactionReceipt(web3);\r\n            overrides.decodeParameters(web3);\r\n        });\r\n    }\r\n};\r\nconst overrides = {\r\n    // The ts-ignores are ignoring the checks that are\r\n    // saying that web3.eth.getBlock is a function and doesn't\r\n    // have a `method` property, which it does\r\n    \"getBlock\": (web3) => {\r\n        // @ts-ignore\r\n        const _oldBlockFormatter = web3.eth.getBlock.method.outputFormatter;\r\n        // @ts-ignore\r\n        web3.eth.getBlock.method.outputFormatter = (block) => {\r\n            const _oldTimestamp = block.timestamp;\r\n            const _oldGasLimit = block.gasLimit;\r\n            const _oldGasUsed = block.gasUsed;\r\n            // Quorum uses nanoseconds instead of seconds in timestamp\r\n            let timestamp = new bn_js_1.default(block.timestamp.slice(2), 16);\r\n            timestamp = timestamp.div(new bn_js_1.default(10).pow(new bn_js_1.default(9)));\r\n            block.timestamp = \"0x\" + timestamp.toString(16);\r\n            // Since we're overwriting the gasLimit/Used later,\r\n            // it doesn't matter what it is before the call\r\n            // The same applies to the timestamp, but I reduced\r\n            // the precision since there was an accurate representation\r\n            // We do this because Quorum can have large block/transaction\r\n            // gas limits\r\n            block.gasLimit = \"0x0\";\r\n            block.gasUsed = \"0x0\";\r\n            // @ts-ignore\r\n            let result = _oldBlockFormatter.call(web3.eth.getBlock.method, block);\r\n            // Perhaps there is a better method of doing this,\r\n            // but the raw hexstrings work for the time being\r\n            result.timestamp = _oldTimestamp;\r\n            result.gasLimit = _oldGasLimit;\r\n            result.gasUsed = _oldGasUsed;\r\n            return result;\r\n        };\r\n    },\r\n    \"getTransaction\": (web3) => {\r\n        const _oldTransactionFormatter = \r\n        // @ts-ignore\r\n        web3.eth.getTransaction.method.outputFormatter;\r\n        // @ts-ignore\r\n        web3.eth.getTransaction.method.outputFormatter = (tx) => {\r\n            const _oldGas = tx.gas;\r\n            tx.gas = \"0x0\";\r\n            let result = _oldTransactionFormatter.call(\r\n            // @ts-ignore\r\n            web3.eth.getTransaction.method, tx);\r\n            // Perhaps there is a better method of doing this,\r\n            // but the raw hexstrings work for the time being\r\n            result.gas = _oldGas;\r\n            return result;\r\n        };\r\n    },\r\n    \"getTransactionReceipt\": (web3) => {\r\n        const _oldTransactionReceiptFormatter = \r\n        // @ts-ignore\r\n        web3.eth.getTransactionReceipt.method.outputFormatter;\r\n        // @ts-ignore\r\n        web3.eth.getTransactionReceipt.method.outputFormatter = (receipt) => {\r\n            const _oldGasUsed = receipt.gasUsed;\r\n            receipt.gasUsed = \"0x0\";\r\n            let result = _oldTransactionReceiptFormatter.call(\r\n            // @ts-ignore\r\n            web3.eth.getTransactionReceipt.method, receipt);\r\n            // Perhaps there is a better method of doing this,\r\n            // but the raw hexstrings work for the time being\r\n            result.gasUsed = _oldGasUsed;\r\n            return result;\r\n        };\r\n    },\r\n    // The primary difference between this decodeParameters function and web3's\r\n    // is that the 'Out of Gas?' zero/null bytes guard has been removed and any\r\n    // falsy bytes are interpreted as a zero value.\r\n    \"decodeParameters\": (web3) => {\r\n        const _oldDecodeParameters = web3.eth.abi.decodeParameters;\r\n        const ethersAbiCoder = new abi_coder_1.AbiCoder((type, value) => {\r\n            if (type.match(/^u?int/) &&\r\n                !lodash_1.default.isArray(value) &&\r\n                (!lodash_1.default.isObject(value) || value.constructor.name !== \"BN\")) {\r\n                return value.toString();\r\n            }\r\n            return value;\r\n        });\r\n        // result method\r\n        function Result() { }\r\n        web3.eth.abi.decodeParameters = (outputs, bytes) => {\r\n            // if bytes is falsy, we'll pass 64 '0' bits to the ethers.js decoder.\r\n            // the decoder will decode the 64 '0' bits as a 0 value.\r\n            if (!bytes)\r\n                bytes = \"0\".repeat(64);\r\n            const res = ethersAbiCoder.decode(\r\n            //@ts-ignore 'mapTypes' not existing on type 'ABI'\r\n            web3.eth.abi.mapTypes(outputs), `0x${bytes.replace(/0x/i, \"\")}`);\r\n            //@ts-ignore complaint regarding Result method\r\n            const returnValue = new Result();\r\n            returnValue.__length__ = 0;\r\n            outputs.forEach((output, i) => {\r\n                let decodedValue = res[returnValue.__length__];\r\n                decodedValue = decodedValue === \"0x\" ? null : decodedValue;\r\n                returnValue[i] = decodedValue;\r\n                // @ts-ignore object not having name key\r\n                if (lodash_1.default.isObject(output) && output.name) {\r\n                    // @ts-ignore object not having name key\r\n                    returnValue[output.name] = decodedValue;\r\n                }\r\n                returnValue.__length__++;\r\n            });\r\n            return returnValue;\r\n        };\r\n    }\r\n};\r\n//# sourceMappingURL=quorum-overloads.js.map"]},"metadata":{},"sourceType":"script"}