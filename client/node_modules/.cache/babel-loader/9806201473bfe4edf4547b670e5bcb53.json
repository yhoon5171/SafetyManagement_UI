{"ast":null,"code":"/*\r\n    This file is part of web3.js.\r\n\r\n    web3.js is free software: you can redistribute it and/or modify\r\n    it under the terms of the GNU Lesser General Public License as published by\r\n    the Free Software Foundation, either version 3 of the License, or\r\n    (at your option) any later version.\r\n\r\n    web3.js is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n    GNU Lesser General Public License for more details.\r\n\r\n    You should have received a copy of the GNU Lesser General Public License\r\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\n\n/**\r\n * @file contract.js\r\n *\r\n * To initialize a contract use:\r\n *\r\n *  var Contract = require('web3-eth-contract');\r\n *  Contract.setProvider('ws://localhost:8546');\r\n *  var contract = new Contract(abi, address, ...);\r\n *\r\n * @author Fabian Vogelsteller <fabian@ethereum.org>\r\n * @date 2017\r\n */\n\"use strict\";\n\nvar _ = require('underscore');\n\nvar core = require('web3-core');\n\nvar Method = require('web3-core-method');\n\nvar utils = require('web3-utils');\n\nvar Subscription = require('web3-core-subscriptions').subscription;\n\nvar formatters = require('web3-core-helpers').formatters;\n\nvar errors = require('web3-core-helpers').errors;\n\nvar promiEvent = require('web3-core-promievent');\n\nvar abi = require('web3-eth-abi');\n/**\r\n * Should be called to create new contract instance\r\n *\r\n * @method Contract\r\n * @constructor\r\n * @param {Array} jsonInterface\r\n * @param {String} address\r\n * @param {Object} options\r\n */\n\n\nvar Contract = function Contract(jsonInterface, address, options) {\n  var _this = this,\n      args = Array.prototype.slice.call(arguments);\n\n  if (!(this instanceof Contract)) {\n    throw new Error('Please use the \"new\" keyword to instantiate a web3.eth.contract() object!');\n  } // sets _requestmanager\n\n\n  core.packageInit(this, [this.constructor.currentProvider]);\n  this.clearSubscriptions = this._requestManager.clearSubscriptions;\n\n  if (!jsonInterface || !Array.isArray(jsonInterface)) {\n    throw new Error('You must provide the json interface of the contract when instantiating a contract object.');\n  } // create the options object\n\n\n  this.options = {};\n  var lastArg = args[args.length - 1];\n\n  if (_.isObject(lastArg) && !_.isArray(lastArg)) {\n    options = lastArg;\n    this.options = _.extend(this.options, this._getOrSetDefaultOptions(options));\n\n    if (_.isObject(address)) {\n      address = null;\n    }\n  } // set address\n\n\n  Object.defineProperty(this.options, 'address', {\n    set: function (value) {\n      if (value) {\n        _this._address = utils.toChecksumAddress(formatters.inputAddressFormatter(value));\n      }\n    },\n    get: function () {\n      return _this._address;\n    },\n    enumerable: true\n  }); // add method and event signatures, when the jsonInterface gets set\n\n  Object.defineProperty(this.options, 'jsonInterface', {\n    set: function (value) {\n      _this.methods = {};\n      _this.events = {};\n      _this._jsonInterface = value.map(function (method) {\n        var func, funcName; // make constant and payable backwards compatible\n\n        method.constant = method.stateMutability === \"view\" || method.stateMutability === \"pure\" || method.constant;\n        method.payable = method.stateMutability === \"payable\" || method.payable;\n\n        if (method.name) {\n          funcName = utils._jsonInterfaceMethodToString(method);\n        } // function\n\n\n        if (method.type === 'function') {\n          method.signature = abi.encodeFunctionSignature(funcName);\n          func = _this._createTxObject.bind({\n            method: method,\n            parent: _this\n          }); // add method only if not one already exists\n\n          if (!_this.methods[method.name]) {\n            _this.methods[method.name] = func;\n          } else {\n            var cascadeFunc = _this._createTxObject.bind({\n              method: method,\n              parent: _this,\n              nextMethod: _this.methods[method.name]\n            });\n\n            _this.methods[method.name] = cascadeFunc;\n          } // definitely add the method based on its signature\n\n\n          _this.methods[method.signature] = func; // add method by name\n\n          _this.methods[funcName] = func; // event\n        } else if (method.type === 'event') {\n          method.signature = abi.encodeEventSignature(funcName);\n\n          var event = _this._on.bind(_this, method.signature); // add method only if not already exists\n\n\n          if (!_this.events[method.name] || _this.events[method.name].name === 'bound ') _this.events[method.name] = event; // definitely add the method based on its signature\n\n          _this.events[method.signature] = event; // add event by name\n\n          _this.events[funcName] = event;\n        }\n\n        return method;\n      }); // add allEvents\n\n      _this.events.allEvents = _this._on.bind(_this, 'allevents');\n      return _this._jsonInterface;\n    },\n    get: function () {\n      return _this._jsonInterface;\n    },\n    enumerable: true\n  }); // get default account from the Class\n\n  var defaultAccount = this.constructor.defaultAccount;\n  var defaultBlock = this.constructor.defaultBlock || 'latest';\n  Object.defineProperty(this, 'defaultAccount', {\n    get: function () {\n      return defaultAccount;\n    },\n    set: function (val) {\n      if (val) {\n        defaultAccount = utils.toChecksumAddress(formatters.inputAddressFormatter(val));\n      }\n\n      return val;\n    },\n    enumerable: true\n  });\n  Object.defineProperty(this, 'defaultBlock', {\n    get: function () {\n      return defaultBlock;\n    },\n    set: function (val) {\n      defaultBlock = val;\n      return val;\n    },\n    enumerable: true\n  }); // properties\n\n  this.methods = {};\n  this.events = {};\n  this._address = null;\n  this._jsonInterface = []; // set getter/setter properties\n\n  this.options.address = address;\n  this.options.jsonInterface = jsonInterface;\n};\n\nContract.setProvider = function (provider, accounts) {\n  // Contract.currentProvider = provider;\n  core.packageInit(this, [provider]);\n  this._ethAccounts = accounts;\n};\n/**\r\n * Get the callback and modiufy the array if necessary\r\n *\r\n * @method _getCallback\r\n * @param {Array} args\r\n * @return {Function} the callback\r\n */\n\n\nContract.prototype._getCallback = function getCallback(args) {\n  if (args && _.isFunction(args[args.length - 1])) {\n    return args.pop(); // modify the args array!\n  }\n};\n/**\r\n * Checks that no listener with name \"newListener\" or \"removeListener\" is added.\r\n *\r\n * @method _checkListener\r\n * @param {String} type\r\n * @param {String} event\r\n * @return {Object} the contract instance\r\n */\n\n\nContract.prototype._checkListener = function (type, event) {\n  if (event === type) {\n    throw new Error('The event \"' + type + '\" is a reserved event name, you can\\'t use it.');\n  }\n};\n/**\r\n * Use default values, if options are not available\r\n *\r\n * @method _getOrSetDefaultOptions\r\n * @param {Object} options the options gived by the user\r\n * @return {Object} the options with gaps filled by defaults\r\n */\n\n\nContract.prototype._getOrSetDefaultOptions = function getOrSetDefaultOptions(options) {\n  var gasPrice = options.gasPrice ? String(options.gasPrice) : null;\n  var from = options.from ? utils.toChecksumAddress(formatters.inputAddressFormatter(options.from)) : null;\n  options.data = options.data || this.options.data;\n  options.from = from || this.options.from;\n  options.gasPrice = gasPrice || this.options.gasPrice;\n  options.gas = options.gas || options.gasLimit || this.options.gas; // TODO replace with only gasLimit?\n\n  delete options.gasLimit;\n  return options;\n};\n/**\r\n * Should be used to encode indexed params and options to one final object\r\n *\r\n * @method _encodeEventABI\r\n * @param {Object} event\r\n * @param {Object} options\r\n * @return {Object} everything combined together and encoded\r\n */\n\n\nContract.prototype._encodeEventABI = function (event, options) {\n  options = options || {};\n  var filter = options.filter || {},\n      result = {};\n  ['fromBlock', 'toBlock'].filter(function (f) {\n    return options[f] !== undefined;\n  }).forEach(function (f) {\n    result[f] = formatters.inputBlockNumberFormatter(options[f]);\n  }); // use given topics\n\n  if (_.isArray(options.topics)) {\n    result.topics = options.topics; // create topics based on filter\n  } else {\n    result.topics = []; // add event signature\n\n    if (event && !event.anonymous && event.name !== 'ALLEVENTS') {\n      result.topics.push(event.signature);\n    } // add event topics (indexed arguments)\n\n\n    if (event.name !== 'ALLEVENTS') {\n      var indexedTopics = event.inputs.filter(function (i) {\n        return i.indexed === true;\n      }).map(function (i) {\n        var value = filter[i.name];\n\n        if (!value) {\n          return null;\n        } // TODO: https://github.com/ethereum/web3.js/issues/344\n        // TODO: deal properly with components\n\n\n        if (_.isArray(value)) {\n          return value.map(function (v) {\n            return abi.encodeParameter(i.type, v);\n          });\n        }\n\n        return abi.encodeParameter(i.type, value);\n      });\n      result.topics = result.topics.concat(indexedTopics);\n    }\n\n    if (!result.topics.length) delete result.topics;\n  }\n\n  if (this.options.address) {\n    result.address = this.options.address.toLowerCase();\n  }\n\n  return result;\n};\n/**\r\n * Should be used to decode indexed params and options\r\n *\r\n * @method _decodeEventABI\r\n * @param {Object} data\r\n * @return {Object} result object with decoded indexed && not indexed params\r\n */\n\n\nContract.prototype._decodeEventABI = function (data) {\n  var event = this;\n  data.data = data.data || '';\n  data.topics = data.topics || [];\n  var result = formatters.outputLogFormatter(data); // if allEvents get the right event\n\n  if (event.name === 'ALLEVENTS') {\n    event = event.jsonInterface.find(function (intf) {\n      return intf.signature === data.topics[0];\n    }) || {\n      anonymous: true\n    };\n  } // create empty inputs if none are present (e.g. anonymous events on allEvents)\n\n\n  event.inputs = event.inputs || [];\n  var argTopics = event.anonymous ? data.topics : data.topics.slice(1);\n  result.returnValues = abi.decodeLog(event.inputs, data.data, argTopics);\n  delete result.returnValues.__length__; // add name\n\n  result.event = event.name; // add signature\n\n  result.signature = event.anonymous || !data.topics[0] ? null : data.topics[0]; // move the data and topics to \"raw\"\n\n  result.raw = {\n    data: result.data,\n    topics: result.topics\n  };\n  delete result.data;\n  delete result.topics;\n  return result;\n};\n/**\r\n * Encodes an ABI for a method, including signature or the method.\r\n * Or when constructor encodes only the constructor parameters.\r\n *\r\n * @method _encodeMethodABI\r\n * @param {Mixed} args the arguments to encode\r\n * @param {String} the encoded ABI\r\n */\n\n\nContract.prototype._encodeMethodABI = function _encodeMethodABI() {\n  var methodSignature = this._method.signature,\n      args = this.arguments || [];\n  var signature = false,\n      paramsABI = this._parent.options.jsonInterface.filter(function (json) {\n    return methodSignature === 'constructor' && json.type === methodSignature || (json.signature === methodSignature || json.signature === methodSignature.replace('0x', '') || json.name === methodSignature) && json.type === 'function';\n  }).map(function (json) {\n    var inputLength = _.isArray(json.inputs) ? json.inputs.length : 0;\n\n    if (inputLength !== args.length) {\n      throw new Error('The number of arguments is not matching the methods required number. You need to pass ' + inputLength + ' arguments.');\n    }\n\n    if (json.type === 'function') {\n      signature = json.signature;\n    }\n\n    return _.isArray(json.inputs) ? json.inputs : [];\n  }).map(function (inputs) {\n    return abi.encodeParameters(inputs, args).replace('0x', '');\n  })[0] || ''; // return constructor\n\n  if (methodSignature === 'constructor') {\n    if (!this._deployData) throw new Error('The contract has no contract data option set. This is necessary to append the constructor parameters.');\n    return this._deployData + paramsABI; // return method\n  } else {\n    var returnValue = signature ? signature + paramsABI : paramsABI;\n\n    if (!returnValue) {\n      throw new Error('Couldn\\'t find a matching contract method named \"' + this._method.name + '\".');\n    } else {\n      return returnValue;\n    }\n  }\n};\n/**\r\n * Decode method return values\r\n *\r\n * @method _decodeMethodReturn\r\n * @param {Array} outputs\r\n * @param {String} returnValues\r\n * @return {Object} decoded output return values\r\n */\n\n\nContract.prototype._decodeMethodReturn = function (outputs, returnValues) {\n  if (!returnValues) {\n    return null;\n  }\n\n  returnValues = returnValues.length >= 2 ? returnValues.slice(2) : returnValues;\n  var result = abi.decodeParameters(outputs, returnValues);\n\n  if (result.__length__ === 1) {\n    return result[0];\n  } else {\n    delete result.__length__;\n    return result;\n  }\n};\n/**\r\n * Deploys a contract and fire events based on its state: transactionHash, receipt\r\n *\r\n * All event listeners will be removed, once the last possible event is fired (\"error\", or \"receipt\")\r\n *\r\n * @method deploy\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} EventEmitter possible events are \"error\", \"transactionHash\" and \"receipt\"\r\n */\n\n\nContract.prototype.deploy = function (options, callback) {\n  options = options || {};\n  options.arguments = options.arguments || [];\n  options = this._getOrSetDefaultOptions(options); // return error, if no \"data\" is specified\n\n  if (!options.data) {\n    return utils._fireError(new Error('No \"data\" specified in neither the given options, nor the default options.'), null, null, callback);\n  }\n\n  var constructor = _.find(this.options.jsonInterface, function (method) {\n    return method.type === 'constructor';\n  }) || {};\n  constructor.signature = 'constructor';\n  return this._createTxObject.apply({\n    method: constructor,\n    parent: this,\n    deployData: options.data,\n    _ethAccounts: this.constructor._ethAccounts\n  }, options.arguments);\n};\n/**\r\n * Gets the event signature and outputformatters\r\n *\r\n * @method _generateEventOptions\r\n * @param {Object} event\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} the event options object\r\n */\n\n\nContract.prototype._generateEventOptions = function () {\n  var args = Array.prototype.slice.call(arguments); // get the callback\n\n  var callback = this._getCallback(args); // get the options\n\n\n  var options = _.isObject(args[args.length - 1]) ? args.pop() : {};\n  var event = _.isString(args[0]) ? args[0] : 'allevents';\n  event = event.toLowerCase() === 'allevents' ? {\n    name: 'ALLEVENTS',\n    jsonInterface: this.options.jsonInterface\n  } : this.options.jsonInterface.find(function (json) {\n    return json.type === 'event' && (json.name === event || json.signature === '0x' + event.replace('0x', ''));\n  });\n\n  if (!event) {\n    throw new Error('Event \"' + event.name + '\" doesn\\'t exist in this contract.');\n  }\n\n  if (!utils.isAddress(this.options.address)) {\n    throw new Error('This contract object doesn\\'t have address set yet, please set an address first.');\n  }\n\n  return {\n    params: this._encodeEventABI(event, options),\n    event: event,\n    callback: callback\n  };\n};\n/**\r\n * Adds event listeners and creates a subscription, and remove it once its fired.\r\n *\r\n * @method clone\r\n * @return {Object} the event subscription\r\n */\n\n\nContract.prototype.clone = function () {\n  return new this.constructor(this.options.jsonInterface, this.options.address, this.options);\n};\n/**\r\n * Adds event listeners and creates a subscription, and remove it once its fired.\r\n *\r\n * @method once\r\n * @param {String} event\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} the event subscription\r\n */\n\n\nContract.prototype.once = function (event, options, callback) {\n  var args = Array.prototype.slice.call(arguments); // get the callback\n\n  callback = this._getCallback(args);\n\n  if (!callback) {\n    throw new Error('Once requires a callback as the second parameter.');\n  } // don't allow fromBlock\n\n\n  if (options) delete options.fromBlock; // don't return as once shouldn't provide \"on\"\n\n  this._on(event, options, function (err, res, sub) {\n    sub.unsubscribe();\n\n    if (_.isFunction(callback)) {\n      callback(err, res, sub);\n    }\n  });\n\n  return undefined;\n};\n/**\r\n * Adds event listeners and creates a subscription.\r\n *\r\n * @method _on\r\n * @param {String} event\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} the event subscription\r\n */\n\n\nContract.prototype._on = function () {\n  var subOptions = this._generateEventOptions.apply(this, arguments); // prevent the event \"newListener\" and \"removeListener\" from being overwritten\n\n\n  this._checkListener('newListener', subOptions.event.name, subOptions.callback);\n\n  this._checkListener('removeListener', subOptions.event.name, subOptions.callback); // TODO check if listener already exists? and reuse subscription if options are the same.\n  // create new subscription\n\n\n  var subscription = new Subscription({\n    subscription: {\n      params: 1,\n      inputFormatter: [formatters.inputLogFormatter],\n      outputFormatter: this._decodeEventABI.bind(subOptions.event),\n      // DUBLICATE, also in web3-eth\n      subscriptionHandler: function (output) {\n        if (output.removed) {\n          this.emit('changed', output);\n        } else {\n          this.emit('data', output);\n        }\n\n        if (_.isFunction(this.callback)) {\n          this.callback(null, output, this);\n        }\n      }\n    },\n    type: 'eth',\n    requestManager: this._requestManager\n  });\n  subscription.subscribe('logs', subOptions.params, subOptions.callback || function () {});\n  return subscription;\n};\n/**\r\n * Get past events from contracts\r\n *\r\n * @method getPastEvents\r\n * @param {String} event\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} the promievent\r\n */\n\n\nContract.prototype.getPastEvents = function () {\n  var subOptions = this._generateEventOptions.apply(this, arguments);\n\n  var getPastLogs = new Method({\n    name: 'getPastLogs',\n    call: 'eth_getLogs',\n    params: 1,\n    inputFormatter: [formatters.inputLogFormatter],\n    outputFormatter: this._decodeEventABI.bind(subOptions.event)\n  });\n  getPastLogs.setRequestManager(this._requestManager);\n  var call = getPastLogs.buildCall();\n  getPastLogs = null;\n  return call(subOptions.params, subOptions.callback);\n};\n/**\r\n * returns the an object with call, send, estimate functions\r\n *\r\n * @method _createTxObject\r\n * @returns {Object} an object with functions to call the methods\r\n */\n\n\nContract.prototype._createTxObject = function _createTxObject() {\n  var args = Array.prototype.slice.call(arguments);\n  var txObject = {};\n\n  if (this.method.type === 'function') {\n    txObject.call = this.parent._executeMethod.bind(txObject, 'call');\n    txObject.call.request = this.parent._executeMethod.bind(txObject, 'call', true); // to make batch requests\n  }\n\n  txObject.send = this.parent._executeMethod.bind(txObject, 'send');\n  txObject.send.request = this.parent._executeMethod.bind(txObject, 'send', true); // to make batch requests\n\n  txObject.encodeABI = this.parent._encodeMethodABI.bind(txObject);\n  txObject.estimateGas = this.parent._executeMethod.bind(txObject, 'estimate');\n\n  if (args && this.method.inputs && args.length !== this.method.inputs.length) {\n    if (this.nextMethod) {\n      return this.nextMethod.apply(null, args);\n    }\n\n    throw errors.InvalidNumberOfParams(args.length, this.method.inputs.length, this.method.name);\n  }\n\n  txObject.arguments = args || [];\n  txObject._method = this.method;\n  txObject._parent = this.parent;\n  txObject._ethAccounts = this.parent.constructor._ethAccounts || this._ethAccounts;\n\n  if (this.deployData) {\n    txObject._deployData = this.deployData;\n  }\n\n  return txObject;\n};\n/**\r\n * Generates the options for the execute call\r\n *\r\n * @method _processExecuteArguments\r\n * @param {Array} args\r\n * @param {Promise} defer\r\n */\n\n\nContract.prototype._processExecuteArguments = function _processExecuteArguments(args, defer) {\n  var processedArgs = {};\n  processedArgs.type = args.shift(); // get the callback\n\n  processedArgs.callback = this._parent._getCallback(args); // get block number to use for call\n\n  if (processedArgs.type === 'call' && args[args.length - 1] !== true && (_.isString(args[args.length - 1]) || isFinite(args[args.length - 1]))) processedArgs.defaultBlock = args.pop(); // get the options\n\n  processedArgs.options = _.isObject(args[args.length - 1]) ? args.pop() : {}; // get the generateRequest argument for batch requests\n\n  processedArgs.generateRequest = args[args.length - 1] === true ? args.pop() : false;\n  processedArgs.options = this._parent._getOrSetDefaultOptions(processedArgs.options);\n  processedArgs.options.data = this.encodeABI(); // add contract address\n\n  if (!this._deployData && !utils.isAddress(this._parent.options.address)) throw new Error('This contract object doesn\\'t have address set yet, please set an address first.');\n  if (!this._deployData) processedArgs.options.to = this._parent.options.address; // return error, if no \"data\" is specified\n\n  if (!processedArgs.options.data) return utils._fireError(new Error('Couldn\\'t find a matching contract method, or the number of parameters is wrong.'), defer.eventEmitter, defer.reject, processedArgs.callback);\n  return processedArgs;\n};\n/**\r\n * Executes a call, transact or estimateGas on a contract function\r\n *\r\n * @method _executeMethod\r\n * @param {String} type the type this execute function should execute\r\n * @param {Boolean} makeRequest if true, it simply returns the request parameters, rather than executing it\r\n */\n\n\nContract.prototype._executeMethod = function _executeMethod() {\n  var _this = this,\n      args = this._parent._processExecuteArguments.call(this, Array.prototype.slice.call(arguments), defer),\n      defer = promiEvent(args.type !== 'send'),\n      ethAccounts = _this.constructor._ethAccounts || _this._ethAccounts; // simple return request for batch requests\n\n\n  if (args.generateRequest) {\n    var payload = {\n      params: [formatters.inputCallFormatter.call(this._parent, args.options)],\n      callback: args.callback\n    };\n\n    if (args.type === 'call') {\n      payload.params.push(formatters.inputDefaultBlockNumberFormatter.call(this._parent, args.defaultBlock));\n      payload.method = 'eth_call';\n      payload.format = this._parent._decodeMethodReturn.bind(null, this._method.outputs);\n    } else {\n      payload.method = 'eth_sendTransaction';\n    }\n\n    return payload;\n  } else {\n    switch (args.type) {\n      case 'estimate':\n        var estimateGas = new Method({\n          name: 'estimateGas',\n          call: 'eth_estimateGas',\n          params: 1,\n          inputFormatter: [formatters.inputCallFormatter],\n          outputFormatter: utils.hexToNumber,\n          requestManager: _this._parent._requestManager,\n          accounts: ethAccounts,\n          // is eth.accounts (necessary for wallet signing)\n          defaultAccount: _this._parent.defaultAccount,\n          defaultBlock: _this._parent.defaultBlock\n        }).createFunction();\n        return estimateGas(args.options, args.callback);\n\n      case 'call':\n        // TODO check errors: missing \"from\" should give error on deploy and send, call ?\n        var call = new Method({\n          name: 'call',\n          call: 'eth_call',\n          params: 2,\n          inputFormatter: [formatters.inputCallFormatter, formatters.inputDefaultBlockNumberFormatter],\n          // add output formatter for decoding\n          outputFormatter: function (result) {\n            return _this._parent._decodeMethodReturn(_this._method.outputs, result);\n          },\n          requestManager: _this._parent._requestManager,\n          accounts: ethAccounts,\n          // is eth.accounts (necessary for wallet signing)\n          defaultAccount: _this._parent.defaultAccount,\n          defaultBlock: _this._parent.defaultBlock\n        }).createFunction();\n        return call(args.options, args.defaultBlock, args.callback);\n\n      case 'send':\n        // return error, if no \"from\" is specified\n        if (!utils.isAddress(args.options.from)) {\n          return utils._fireError(new Error('No \"from\" address specified in neither the given options, nor the default options.'), defer.eventEmitter, defer.reject, args.callback);\n        }\n\n        if (_.isBoolean(this._method.payable) && !this._method.payable && args.options.value && args.options.value > 0) {\n          return utils._fireError(new Error('Can not send value to non-payable contract method or constructor'), defer.eventEmitter, defer.reject, args.callback);\n        } // make sure receipt logs are decoded\n\n\n        var extraFormatters = {\n          receiptFormatter: function (receipt) {\n            if (_.isArray(receipt.logs)) {\n              // decode logs\n              var events = _.map(receipt.logs, function (log) {\n                return _this._parent._decodeEventABI.call({\n                  name: 'ALLEVENTS',\n                  jsonInterface: _this._parent.options.jsonInterface\n                }, log);\n              }); // make log names keys\n\n\n              receipt.events = {};\n              var count = 0;\n              events.forEach(function (ev) {\n                if (ev.event) {\n                  // if > 1 of the same event, don't overwrite any existing events\n                  if (receipt.events[ev.event]) {\n                    if (Array.isArray(receipt.events[ev.event])) {\n                      receipt.events[ev.event].push(ev);\n                    } else {\n                      receipt.events[ev.event] = [receipt.events[ev.event], ev];\n                    }\n                  } else {\n                    receipt.events[ev.event] = ev;\n                  }\n                } else {\n                  receipt.events[count] = ev;\n                  count++;\n                }\n              });\n              delete receipt.logs;\n            }\n\n            return receipt;\n          },\n          contractDeployFormatter: function (receipt) {\n            var newContract = _this._parent.clone();\n\n            newContract.options.address = receipt.contractAddress;\n            return newContract;\n          }\n        };\n        var sendTransaction = new Method({\n          name: 'sendTransaction',\n          call: 'eth_sendTransaction',\n          params: 1,\n          inputFormatter: [formatters.inputTransactionFormatter],\n          requestManager: _this._parent._requestManager,\n          accounts: _this.constructor._ethAccounts || _this._ethAccounts,\n          // is eth.accounts (necessary for wallet signing)\n          defaultAccount: _this._parent.defaultAccount,\n          defaultBlock: _this._parent.defaultBlock,\n          extraFormatters: extraFormatters\n        }).createFunction();\n        return sendTransaction(args.options, args.callback);\n    }\n  }\n};\n\nmodule.exports = Contract;","map":{"version":3,"names":["_","require","core","Method","utils","Subscription","subscription","formatters","errors","promiEvent","abi","Contract","jsonInterface","address","options","_this","args","Array","prototype","slice","call","arguments","Error","packageInit","constructor","currentProvider","clearSubscriptions","_requestManager","isArray","lastArg","length","isObject","extend","_getOrSetDefaultOptions","Object","defineProperty","set","value","_address","toChecksumAddress","inputAddressFormatter","get","enumerable","methods","events","_jsonInterface","map","method","func","funcName","constant","stateMutability","payable","name","_jsonInterfaceMethodToString","type","signature","encodeFunctionSignature","_createTxObject","bind","parent","cascadeFunc","nextMethod","encodeEventSignature","event","_on","allEvents","defaultAccount","defaultBlock","val","setProvider","provider","accounts","_ethAccounts","_getCallback","getCallback","isFunction","pop","_checkListener","getOrSetDefaultOptions","gasPrice","String","from","data","gas","gasLimit","_encodeEventABI","filter","result","f","undefined","forEach","inputBlockNumberFormatter","topics","anonymous","push","indexedTopics","inputs","i","indexed","v","encodeParameter","concat","toLowerCase","_decodeEventABI","outputLogFormatter","find","intf","argTopics","returnValues","decodeLog","__length__","raw","_encodeMethodABI","methodSignature","_method","paramsABI","_parent","json","replace","inputLength","encodeParameters","_deployData","returnValue","_decodeMethodReturn","outputs","decodeParameters","deploy","callback","_fireError","apply","deployData","_generateEventOptions","isString","isAddress","params","clone","once","fromBlock","err","res","sub","unsubscribe","subOptions","inputFormatter","inputLogFormatter","outputFormatter","subscriptionHandler","output","removed","emit","requestManager","subscribe","getPastEvents","getPastLogs","setRequestManager","buildCall","txObject","_executeMethod","request","send","encodeABI","estimateGas","InvalidNumberOfParams","_processExecuteArguments","defer","processedArgs","shift","isFinite","generateRequest","to","eventEmitter","reject","ethAccounts","payload","inputCallFormatter","inputDefaultBlockNumberFormatter","format","hexToNumber","createFunction","isBoolean","extraFormatters","receiptFormatter","receipt","logs","log","count","ev","contractDeployFormatter","newContract","contractAddress","sendTransaction","inputTransactionFormatter","module","exports"],"sources":["C:/Users/mcnl/Desktop/gong/BlockchainSafetyManagement/client/node_modules/truffle-interface-adapter/node_modules/web3-eth-contract/src/index.js"],"sourcesContent":["/*\r\n    This file is part of web3.js.\r\n\r\n    web3.js is free software: you can redistribute it and/or modify\r\n    it under the terms of the GNU Lesser General Public License as published by\r\n    the Free Software Foundation, either version 3 of the License, or\r\n    (at your option) any later version.\r\n\r\n    web3.js is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n    GNU Lesser General Public License for more details.\r\n\r\n    You should have received a copy of the GNU Lesser General Public License\r\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\r\n*/\r\n/**\r\n * @file contract.js\r\n *\r\n * To initialize a contract use:\r\n *\r\n *  var Contract = require('web3-eth-contract');\r\n *  Contract.setProvider('ws://localhost:8546');\r\n *  var contract = new Contract(abi, address, ...);\r\n *\r\n * @author Fabian Vogelsteller <fabian@ethereum.org>\r\n * @date 2017\r\n */\r\n\r\n\r\n\"use strict\";\r\n\r\n\r\nvar _ = require('underscore');\r\nvar core = require('web3-core');\r\nvar Method = require('web3-core-method');\r\nvar utils = require('web3-utils');\r\nvar Subscription = require('web3-core-subscriptions').subscription;\r\nvar formatters = require('web3-core-helpers').formatters;\r\nvar errors = require('web3-core-helpers').errors;\r\nvar promiEvent = require('web3-core-promievent');\r\nvar abi = require('web3-eth-abi');\r\n\r\n\r\n/**\r\n * Should be called to create new contract instance\r\n *\r\n * @method Contract\r\n * @constructor\r\n * @param {Array} jsonInterface\r\n * @param {String} address\r\n * @param {Object} options\r\n */\r\nvar Contract = function Contract(jsonInterface, address, options) {\r\n    var _this = this,\r\n        args = Array.prototype.slice.call(arguments);\r\n\r\n    if(!(this instanceof Contract)) {\r\n        throw new Error('Please use the \"new\" keyword to instantiate a web3.eth.contract() object!');\r\n    }\r\n\r\n    // sets _requestmanager\r\n    core.packageInit(this, [this.constructor.currentProvider]);\r\n\r\n    this.clearSubscriptions = this._requestManager.clearSubscriptions;\r\n\r\n\r\n\r\n    if(!jsonInterface || !(Array.isArray(jsonInterface))) {\r\n        throw new Error('You must provide the json interface of the contract when instantiating a contract object.');\r\n    }\r\n\r\n\r\n\r\n    // create the options object\r\n    this.options = {};\r\n\r\n    var lastArg = args[args.length - 1];\r\n    if(_.isObject(lastArg) && !_.isArray(lastArg)) {\r\n        options = lastArg;\r\n\r\n        this.options = _.extend(this.options, this._getOrSetDefaultOptions(options));\r\n        if(_.isObject(address)) {\r\n            address = null;\r\n        }\r\n    }\r\n\r\n    // set address\r\n    Object.defineProperty(this.options, 'address', {\r\n        set: function(value){\r\n            if(value) {\r\n                _this._address = utils.toChecksumAddress(formatters.inputAddressFormatter(value));\r\n            }\r\n        },\r\n        get: function(){\r\n            return _this._address;\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    // add method and event signatures, when the jsonInterface gets set\r\n    Object.defineProperty(this.options, 'jsonInterface', {\r\n        set: function(value){\r\n            _this.methods = {};\r\n            _this.events = {};\r\n\r\n            _this._jsonInterface = value.map(function(method) {\r\n                var func,\r\n                    funcName;\r\n\r\n                // make constant and payable backwards compatible\r\n                method.constant = (method.stateMutability === \"view\" || method.stateMutability === \"pure\" || method.constant);\r\n                method.payable = (method.stateMutability === \"payable\" || method.payable);\r\n\r\n\r\n                if (method.name) {\r\n                    funcName = utils._jsonInterfaceMethodToString(method);\r\n                }\r\n\r\n\r\n                // function\r\n                if (method.type === 'function') {\r\n                    method.signature = abi.encodeFunctionSignature(funcName);\r\n                    func = _this._createTxObject.bind({\r\n                        method: method,\r\n                        parent: _this\r\n                    });\r\n\r\n\r\n                    // add method only if not one already exists\r\n                    if(!_this.methods[method.name]) {\r\n                        _this.methods[method.name] = func;\r\n                    } else {\r\n                        var cascadeFunc = _this._createTxObject.bind({\r\n                            method: method,\r\n                            parent: _this,\r\n                            nextMethod: _this.methods[method.name]\r\n                        });\r\n                        _this.methods[method.name] = cascadeFunc;\r\n                    }\r\n\r\n                    // definitely add the method based on its signature\r\n                    _this.methods[method.signature] = func;\r\n\r\n                    // add method by name\r\n                    _this.methods[funcName] = func;\r\n\r\n\r\n                // event\r\n                } else if (method.type === 'event') {\r\n                    method.signature = abi.encodeEventSignature(funcName);\r\n                    var event = _this._on.bind(_this, method.signature);\r\n\r\n                    // add method only if not already exists\r\n                    if(!_this.events[method.name] || _this.events[method.name].name === 'bound ')\r\n                        _this.events[method.name] = event;\r\n\r\n                    // definitely add the method based on its signature\r\n                    _this.events[method.signature] = event;\r\n\r\n                    // add event by name\r\n                    _this.events[funcName] = event;\r\n                }\r\n\r\n\r\n                return method;\r\n            });\r\n\r\n            // add allEvents\r\n            _this.events.allEvents = _this._on.bind(_this, 'allevents');\r\n\r\n            return _this._jsonInterface;\r\n        },\r\n        get: function(){\r\n            return _this._jsonInterface;\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    // get default account from the Class\r\n    var defaultAccount = this.constructor.defaultAccount;\r\n    var defaultBlock = this.constructor.defaultBlock || 'latest';\r\n\r\n    Object.defineProperty(this, 'defaultAccount', {\r\n        get: function () {\r\n            return defaultAccount;\r\n        },\r\n        set: function (val) {\r\n            if(val) {\r\n                defaultAccount = utils.toChecksumAddress(formatters.inputAddressFormatter(val));\r\n            }\r\n\r\n            return val;\r\n        },\r\n        enumerable: true\r\n    });\r\n    Object.defineProperty(this, 'defaultBlock', {\r\n        get: function () {\r\n            return defaultBlock;\r\n        },\r\n        set: function (val) {\r\n            defaultBlock = val;\r\n\r\n            return val;\r\n        },\r\n        enumerable: true\r\n    });\r\n\r\n    // properties\r\n    this.methods = {};\r\n    this.events = {};\r\n\r\n    this._address = null;\r\n    this._jsonInterface = [];\r\n\r\n    // set getter/setter properties\r\n    this.options.address = address;\r\n    this.options.jsonInterface = jsonInterface;\r\n\r\n};\r\n\r\nContract.setProvider = function(provider, accounts) {\r\n    // Contract.currentProvider = provider;\r\n    core.packageInit(this, [provider]);\r\n\r\n    this._ethAccounts = accounts;\r\n};\r\n\r\n\r\n/**\r\n * Get the callback and modiufy the array if necessary\r\n *\r\n * @method _getCallback\r\n * @param {Array} args\r\n * @return {Function} the callback\r\n */\r\nContract.prototype._getCallback = function getCallback(args) {\r\n    if (args && _.isFunction(args[args.length - 1])) {\r\n        return args.pop(); // modify the args array!\r\n    }\r\n};\r\n\r\n/**\r\n * Checks that no listener with name \"newListener\" or \"removeListener\" is added.\r\n *\r\n * @method _checkListener\r\n * @param {String} type\r\n * @param {String} event\r\n * @return {Object} the contract instance\r\n */\r\nContract.prototype._checkListener = function(type, event){\r\n    if(event === type) {\r\n        throw new Error('The event \"'+ type +'\" is a reserved event name, you can\\'t use it.');\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * Use default values, if options are not available\r\n *\r\n * @method _getOrSetDefaultOptions\r\n * @param {Object} options the options gived by the user\r\n * @return {Object} the options with gaps filled by defaults\r\n */\r\nContract.prototype._getOrSetDefaultOptions = function getOrSetDefaultOptions(options) {\r\n    var gasPrice = options.gasPrice ? String(options.gasPrice): null;\r\n    var from = options.from ? utils.toChecksumAddress(formatters.inputAddressFormatter(options.from)) : null;\r\n\r\n    options.data = options.data || this.options.data;\r\n\r\n    options.from = from || this.options.from;\r\n    options.gasPrice = gasPrice || this.options.gasPrice;\r\n    options.gas = options.gas || options.gasLimit || this.options.gas;\r\n\r\n    // TODO replace with only gasLimit?\r\n    delete options.gasLimit;\r\n\r\n    return options;\r\n};\r\n\r\n\r\n/**\r\n * Should be used to encode indexed params and options to one final object\r\n *\r\n * @method _encodeEventABI\r\n * @param {Object} event\r\n * @param {Object} options\r\n * @return {Object} everything combined together and encoded\r\n */\r\nContract.prototype._encodeEventABI = function (event, options) {\r\n    options = options || {};\r\n    var filter = options.filter || {},\r\n        result = {};\r\n\r\n    ['fromBlock', 'toBlock'].filter(function (f) {\r\n        return options[f] !== undefined;\r\n    }).forEach(function (f) {\r\n        result[f] = formatters.inputBlockNumberFormatter(options[f]);\r\n    });\r\n\r\n    // use given topics\r\n    if(_.isArray(options.topics)) {\r\n        result.topics = options.topics;\r\n\r\n    // create topics based on filter\r\n    } else {\r\n\r\n        result.topics = [];\r\n\r\n        // add event signature\r\n        if (event && !event.anonymous && event.name !== 'ALLEVENTS') {\r\n            result.topics.push(event.signature);\r\n        }\r\n\r\n        // add event topics (indexed arguments)\r\n        if (event.name !== 'ALLEVENTS') {\r\n            var indexedTopics = event.inputs.filter(function (i) {\r\n                return i.indexed === true;\r\n            }).map(function (i) {\r\n                var value = filter[i.name];\r\n                if (!value) {\r\n                    return null;\r\n                }\r\n\r\n                // TODO: https://github.com/ethereum/web3.js/issues/344\r\n                // TODO: deal properly with components\r\n\r\n                if (_.isArray(value)) {\r\n                    return value.map(function (v) {\r\n                        return abi.encodeParameter(i.type, v);\r\n                    });\r\n                }\r\n                return abi.encodeParameter(i.type, value);\r\n            });\r\n\r\n            result.topics = result.topics.concat(indexedTopics);\r\n        }\r\n\r\n        if(!result.topics.length)\r\n            delete result.topics;\r\n    }\r\n\r\n    if(this.options.address) {\r\n        result.address = this.options.address.toLowerCase();\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n/**\r\n * Should be used to decode indexed params and options\r\n *\r\n * @method _decodeEventABI\r\n * @param {Object} data\r\n * @return {Object} result object with decoded indexed && not indexed params\r\n */\r\nContract.prototype._decodeEventABI = function (data) {\r\n    var event = this;\r\n\r\n    data.data = data.data || '';\r\n    data.topics = data.topics || [];\r\n    var result = formatters.outputLogFormatter(data);\r\n\r\n    // if allEvents get the right event\r\n    if(event.name === 'ALLEVENTS') {\r\n        event = event.jsonInterface.find(function (intf) {\r\n            return (intf.signature === data.topics[0]);\r\n        }) || {anonymous: true};\r\n    }\r\n\r\n    // create empty inputs if none are present (e.g. anonymous events on allEvents)\r\n    event.inputs = event.inputs || [];\r\n\r\n\r\n    var argTopics = event.anonymous ? data.topics : data.topics.slice(1);\r\n\r\n    result.returnValues = abi.decodeLog(event.inputs, data.data, argTopics);\r\n    delete result.returnValues.__length__;\r\n\r\n    // add name\r\n    result.event = event.name;\r\n\r\n    // add signature\r\n    result.signature = (event.anonymous || !data.topics[0]) ? null : data.topics[0];\r\n\r\n    // move the data and topics to \"raw\"\r\n    result.raw = {\r\n        data: result.data,\r\n        topics: result.topics\r\n    };\r\n    delete result.data;\r\n    delete result.topics;\r\n\r\n\r\n    return result;\r\n};\r\n\r\n/**\r\n * Encodes an ABI for a method, including signature or the method.\r\n * Or when constructor encodes only the constructor parameters.\r\n *\r\n * @method _encodeMethodABI\r\n * @param {Mixed} args the arguments to encode\r\n * @param {String} the encoded ABI\r\n */\r\nContract.prototype._encodeMethodABI = function _encodeMethodABI() {\r\n    var methodSignature = this._method.signature,\r\n        args = this.arguments || [];\r\n\r\n    var signature = false,\r\n        paramsABI = this._parent.options.jsonInterface.filter(function (json) {\r\n            return ((methodSignature === 'constructor' && json.type === methodSignature) ||\r\n                ((json.signature === methodSignature || json.signature === methodSignature.replace('0x','') || json.name === methodSignature) && json.type === 'function'));\r\n        }).map(function (json) {\r\n            var inputLength = (_.isArray(json.inputs)) ? json.inputs.length : 0;\r\n\r\n            if (inputLength !== args.length) {\r\n                throw new Error('The number of arguments is not matching the methods required number. You need to pass '+ inputLength +' arguments.');\r\n            }\r\n\r\n            if (json.type === 'function') {\r\n                signature = json.signature;\r\n            }\r\n            return _.isArray(json.inputs) ? json.inputs : [];\r\n        }).map(function (inputs) {\r\n            return abi.encodeParameters(inputs, args).replace('0x','');\r\n        })[0] || '';\r\n\r\n    // return constructor\r\n    if(methodSignature === 'constructor') {\r\n        if(!this._deployData)\r\n            throw new Error('The contract has no contract data option set. This is necessary to append the constructor parameters.');\r\n\r\n        return this._deployData + paramsABI;\r\n\r\n    // return method\r\n    } else {\r\n\r\n        var returnValue = (signature) ? signature + paramsABI : paramsABI;\r\n\r\n        if(!returnValue) {\r\n            throw new Error('Couldn\\'t find a matching contract method named \"'+ this._method.name +'\".');\r\n        } else {\r\n            return returnValue;\r\n        }\r\n    }\r\n\r\n};\r\n\r\n\r\n/**\r\n * Decode method return values\r\n *\r\n * @method _decodeMethodReturn\r\n * @param {Array} outputs\r\n * @param {String} returnValues\r\n * @return {Object} decoded output return values\r\n */\r\nContract.prototype._decodeMethodReturn = function (outputs, returnValues) {\r\n    if (!returnValues) {\r\n        return null;\r\n    }\r\n\r\n    returnValues = returnValues.length >= 2 ? returnValues.slice(2) : returnValues;\r\n    var result = abi.decodeParameters(outputs, returnValues);\r\n\r\n    if (result.__length__ === 1) {\r\n        return result[0];\r\n    } else {\r\n        delete result.__length__;\r\n        return result;\r\n    }\r\n};\r\n\r\n\r\n/**\r\n * Deploys a contract and fire events based on its state: transactionHash, receipt\r\n *\r\n * All event listeners will be removed, once the last possible event is fired (\"error\", or \"receipt\")\r\n *\r\n * @method deploy\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} EventEmitter possible events are \"error\", \"transactionHash\" and \"receipt\"\r\n */\r\nContract.prototype.deploy = function(options, callback){\r\n\r\n    options = options || {};\r\n\r\n    options.arguments = options.arguments || [];\r\n    options = this._getOrSetDefaultOptions(options);\r\n\r\n\r\n    // return error, if no \"data\" is specified\r\n    if(!options.data) {\r\n        return utils._fireError(new Error('No \"data\" specified in neither the given options, nor the default options.'), null, null, callback);\r\n    }\r\n\r\n    var constructor = _.find(this.options.jsonInterface, function (method) {\r\n        return (method.type === 'constructor');\r\n    }) || {};\r\n    constructor.signature = 'constructor';\r\n\r\n    return this._createTxObject.apply({\r\n        method: constructor,\r\n        parent: this,\r\n        deployData: options.data,\r\n        _ethAccounts: this.constructor._ethAccounts\r\n    }, options.arguments);\r\n\r\n};\r\n\r\n/**\r\n * Gets the event signature and outputformatters\r\n *\r\n * @method _generateEventOptions\r\n * @param {Object} event\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} the event options object\r\n */\r\nContract.prototype._generateEventOptions = function() {\r\n    var args = Array.prototype.slice.call(arguments);\r\n\r\n    // get the callback\r\n    var callback = this._getCallback(args);\r\n\r\n    // get the options\r\n    var options = (_.isObject(args[args.length - 1])) ? args.pop() : {};\r\n\r\n    var event = (_.isString(args[0])) ? args[0] : 'allevents';\r\n    event = (event.toLowerCase() === 'allevents') ? {\r\n            name: 'ALLEVENTS',\r\n            jsonInterface: this.options.jsonInterface\r\n        } : this.options.jsonInterface.find(function (json) {\r\n            return (json.type === 'event' && (json.name === event || json.signature === '0x'+ event.replace('0x','')));\r\n        });\r\n\r\n    if (!event) {\r\n        throw new Error('Event \"' + event.name + '\" doesn\\'t exist in this contract.');\r\n    }\r\n\r\n    if (!utils.isAddress(this.options.address)) {\r\n        throw new Error('This contract object doesn\\'t have address set yet, please set an address first.');\r\n    }\r\n\r\n    return {\r\n        params: this._encodeEventABI(event, options),\r\n        event: event,\r\n        callback: callback\r\n    };\r\n};\r\n\r\n/**\r\n * Adds event listeners and creates a subscription, and remove it once its fired.\r\n *\r\n * @method clone\r\n * @return {Object} the event subscription\r\n */\r\nContract.prototype.clone = function() {\r\n    return new this.constructor(this.options.jsonInterface, this.options.address, this.options);\r\n};\r\n\r\n\r\n/**\r\n * Adds event listeners and creates a subscription, and remove it once its fired.\r\n *\r\n * @method once\r\n * @param {String} event\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} the event subscription\r\n */\r\nContract.prototype.once = function(event, options, callback) {\r\n    var args = Array.prototype.slice.call(arguments);\r\n\r\n    // get the callback\r\n    callback = this._getCallback(args);\r\n\r\n    if (!callback) {\r\n        throw new Error('Once requires a callback as the second parameter.');\r\n    }\r\n\r\n    // don't allow fromBlock\r\n    if (options)\r\n        delete options.fromBlock;\r\n\r\n    // don't return as once shouldn't provide \"on\"\r\n    this._on(event, options, function (err, res, sub) {\r\n        sub.unsubscribe();\r\n        if(_.isFunction(callback)){\r\n            callback(err, res, sub);\r\n        }\r\n    });\r\n\r\n    return undefined;\r\n};\r\n\r\n/**\r\n * Adds event listeners and creates a subscription.\r\n *\r\n * @method _on\r\n * @param {String} event\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} the event subscription\r\n */\r\nContract.prototype._on = function(){\r\n    var subOptions = this._generateEventOptions.apply(this, arguments);\r\n\r\n\r\n    // prevent the event \"newListener\" and \"removeListener\" from being overwritten\r\n    this._checkListener('newListener', subOptions.event.name, subOptions.callback);\r\n    this._checkListener('removeListener', subOptions.event.name, subOptions.callback);\r\n\r\n    // TODO check if listener already exists? and reuse subscription if options are the same.\r\n\r\n    // create new subscription\r\n    var subscription = new Subscription({\r\n        subscription: {\r\n            params: 1,\r\n            inputFormatter: [formatters.inputLogFormatter],\r\n            outputFormatter: this._decodeEventABI.bind(subOptions.event),\r\n            // DUBLICATE, also in web3-eth\r\n            subscriptionHandler: function (output) {\r\n                if(output.removed) {\r\n                    this.emit('changed', output);\r\n                } else {\r\n                    this.emit('data', output);\r\n                }\r\n\r\n                if (_.isFunction(this.callback)) {\r\n                    this.callback(null, output, this);\r\n                }\r\n            }\r\n        },\r\n        type: 'eth',\r\n        requestManager: this._requestManager\r\n    });\r\n    subscription.subscribe('logs', subOptions.params, subOptions.callback || function () {});\r\n\r\n    return subscription;\r\n};\r\n\r\n/**\r\n * Get past events from contracts\r\n *\r\n * @method getPastEvents\r\n * @param {String} event\r\n * @param {Object} options\r\n * @param {Function} callback\r\n * @return {Object} the promievent\r\n */\r\nContract.prototype.getPastEvents = function(){\r\n    var subOptions = this._generateEventOptions.apply(this, arguments);\r\n\r\n    var getPastLogs = new Method({\r\n        name: 'getPastLogs',\r\n        call: 'eth_getLogs',\r\n        params: 1,\r\n        inputFormatter: [formatters.inputLogFormatter],\r\n        outputFormatter: this._decodeEventABI.bind(subOptions.event)\r\n    });\r\n    getPastLogs.setRequestManager(this._requestManager);\r\n    var call = getPastLogs.buildCall();\r\n\r\n    getPastLogs = null;\r\n\r\n    return call(subOptions.params, subOptions.callback);\r\n};\r\n\r\n\r\n/**\r\n * returns the an object with call, send, estimate functions\r\n *\r\n * @method _createTxObject\r\n * @returns {Object} an object with functions to call the methods\r\n */\r\nContract.prototype._createTxObject =  function _createTxObject(){\r\n    var args = Array.prototype.slice.call(arguments);\r\n    var txObject = {};\r\n\r\n    if(this.method.type === 'function') {\r\n\r\n        txObject.call = this.parent._executeMethod.bind(txObject, 'call');\r\n        txObject.call.request = this.parent._executeMethod.bind(txObject, 'call', true); // to make batch requests\r\n\r\n    }\r\n\r\n    txObject.send = this.parent._executeMethod.bind(txObject, 'send');\r\n    txObject.send.request = this.parent._executeMethod.bind(txObject, 'send', true); // to make batch requests\r\n    txObject.encodeABI = this.parent._encodeMethodABI.bind(txObject);\r\n    txObject.estimateGas = this.parent._executeMethod.bind(txObject, 'estimate');\r\n\r\n    if (args && this.method.inputs && args.length !== this.method.inputs.length) {\r\n        if (this.nextMethod) {\r\n            return this.nextMethod.apply(null, args);\r\n        }\r\n        throw errors.InvalidNumberOfParams(args.length, this.method.inputs.length, this.method.name);\r\n    }\r\n\r\n    txObject.arguments = args || [];\r\n    txObject._method = this.method;\r\n    txObject._parent = this.parent;\r\n    txObject._ethAccounts = this.parent.constructor._ethAccounts || this._ethAccounts;\r\n\r\n    if(this.deployData) {\r\n        txObject._deployData = this.deployData;\r\n    }\r\n\r\n    return txObject;\r\n};\r\n\r\n\r\n/**\r\n * Generates the options for the execute call\r\n *\r\n * @method _processExecuteArguments\r\n * @param {Array} args\r\n * @param {Promise} defer\r\n */\r\nContract.prototype._processExecuteArguments = function _processExecuteArguments(args, defer) {\r\n    var processedArgs = {};\r\n\r\n    processedArgs.type = args.shift();\r\n\r\n    // get the callback\r\n    processedArgs.callback = this._parent._getCallback(args);\r\n\r\n    // get block number to use for call\r\n    if(processedArgs.type === 'call' && args[args.length - 1] !== true && (_.isString(args[args.length - 1]) || isFinite(args[args.length - 1])))\r\n        processedArgs.defaultBlock = args.pop();\r\n\r\n    // get the options\r\n    processedArgs.options = (_.isObject(args[args.length - 1])) ? args.pop() : {};\r\n\r\n    // get the generateRequest argument for batch requests\r\n    processedArgs.generateRequest = (args[args.length - 1] === true)? args.pop() : false;\r\n\r\n    processedArgs.options = this._parent._getOrSetDefaultOptions(processedArgs.options);\r\n    processedArgs.options.data = this.encodeABI();\r\n\r\n    // add contract address\r\n    if(!this._deployData && !utils.isAddress(this._parent.options.address))\r\n        throw new Error('This contract object doesn\\'t have address set yet, please set an address first.');\r\n\r\n    if(!this._deployData)\r\n        processedArgs.options.to = this._parent.options.address;\r\n\r\n    // return error, if no \"data\" is specified\r\n    if(!processedArgs.options.data)\r\n        return utils._fireError(new Error('Couldn\\'t find a matching contract method, or the number of parameters is wrong.'), defer.eventEmitter, defer.reject, processedArgs.callback);\r\n\r\n    return processedArgs;\r\n};\r\n\r\n/**\r\n * Executes a call, transact or estimateGas on a contract function\r\n *\r\n * @method _executeMethod\r\n * @param {String} type the type this execute function should execute\r\n * @param {Boolean} makeRequest if true, it simply returns the request parameters, rather than executing it\r\n */\r\nContract.prototype._executeMethod = function _executeMethod(){\r\n    var _this = this,\r\n        args = this._parent._processExecuteArguments.call(this, Array.prototype.slice.call(arguments), defer),\r\n        defer = promiEvent((args.type !== 'send')),\r\n        ethAccounts = _this.constructor._ethAccounts || _this._ethAccounts;\r\n\r\n    // simple return request for batch requests\r\n    if(args.generateRequest) {\r\n\r\n        var payload = {\r\n            params: [formatters.inputCallFormatter.call(this._parent, args.options)],\r\n            callback: args.callback\r\n        };\r\n\r\n        if(args.type === 'call') {\r\n            payload.params.push(formatters.inputDefaultBlockNumberFormatter.call(this._parent, args.defaultBlock));\r\n            payload.method = 'eth_call';\r\n            payload.format = this._parent._decodeMethodReturn.bind(null, this._method.outputs);\r\n        } else {\r\n            payload.method = 'eth_sendTransaction';\r\n        }\r\n\r\n        return payload;\r\n\r\n    } else {\r\n\r\n        switch (args.type) {\r\n            case 'estimate':\r\n\r\n                var estimateGas = (new Method({\r\n                    name: 'estimateGas',\r\n                    call: 'eth_estimateGas',\r\n                    params: 1,\r\n                    inputFormatter: [formatters.inputCallFormatter],\r\n                    outputFormatter: utils.hexToNumber,\r\n                    requestManager: _this._parent._requestManager,\r\n                    accounts: ethAccounts, // is eth.accounts (necessary for wallet signing)\r\n                    defaultAccount: _this._parent.defaultAccount,\r\n                    defaultBlock: _this._parent.defaultBlock\r\n                })).createFunction();\r\n\r\n                return estimateGas(args.options, args.callback);\r\n\r\n            case 'call':\r\n\r\n                // TODO check errors: missing \"from\" should give error on deploy and send, call ?\r\n\r\n                var call = (new Method({\r\n                    name: 'call',\r\n                    call: 'eth_call',\r\n                    params: 2,\r\n                    inputFormatter: [formatters.inputCallFormatter, formatters.inputDefaultBlockNumberFormatter],\r\n                    // add output formatter for decoding\r\n                    outputFormatter: function (result) {\r\n                        return _this._parent._decodeMethodReturn(_this._method.outputs, result);\r\n                    },\r\n                    requestManager: _this._parent._requestManager,\r\n                    accounts: ethAccounts, // is eth.accounts (necessary for wallet signing)\r\n                    defaultAccount: _this._parent.defaultAccount,\r\n                    defaultBlock: _this._parent.defaultBlock\r\n                })).createFunction();\r\n\r\n                return call(args.options, args.defaultBlock, args.callback);\r\n\r\n            case 'send':\r\n\r\n                // return error, if no \"from\" is specified\r\n                if(!utils.isAddress(args.options.from)) {\r\n                    return utils._fireError(new Error('No \"from\" address specified in neither the given options, nor the default options.'), defer.eventEmitter, defer.reject, args.callback);\r\n                }\r\n\r\n                if (_.isBoolean(this._method.payable) && !this._method.payable && args.options.value && args.options.value > 0) {\r\n                    return utils._fireError(new Error('Can not send value to non-payable contract method or constructor'), defer.eventEmitter, defer.reject, args.callback);\r\n                }\r\n\r\n\r\n                // make sure receipt logs are decoded\r\n                var extraFormatters = {\r\n                    receiptFormatter: function (receipt) {\r\n                        if (_.isArray(receipt.logs)) {\r\n\r\n                            // decode logs\r\n                            var events = _.map(receipt.logs, function(log) {\r\n                                return _this._parent._decodeEventABI.call({\r\n                                    name: 'ALLEVENTS',\r\n                                    jsonInterface: _this._parent.options.jsonInterface\r\n                                }, log);\r\n                            });\r\n\r\n                            // make log names keys\r\n                            receipt.events = {};\r\n                            var count = 0;\r\n                            events.forEach(function (ev) {\r\n                                if (ev.event) {\r\n                                    // if > 1 of the same event, don't overwrite any existing events\r\n                                    if (receipt.events[ev.event]) {\r\n                                        if (Array.isArray(receipt.events[ ev.event ])) {\r\n                                            receipt.events[ ev.event ].push(ev);\r\n                                        } else {\r\n                                            receipt.events[ev.event] = [receipt.events[ev.event], ev];\r\n                                        }\r\n                                    } else {\r\n                                        receipt.events[ ev.event ] = ev;\r\n                                    }\r\n                                } else {\r\n                                    receipt.events[count] = ev;\r\n                                    count++;\r\n                                }\r\n                            });\r\n\r\n                            delete receipt.logs;\r\n                        }\r\n                        return receipt;\r\n                    },\r\n                    contractDeployFormatter: function (receipt) {\r\n                        var newContract = _this._parent.clone();\r\n                        newContract.options.address = receipt.contractAddress;\r\n                        return newContract;\r\n                    }\r\n                };\r\n\r\n                var sendTransaction = (new Method({\r\n                    name: 'sendTransaction',\r\n                    call: 'eth_sendTransaction',\r\n                    params: 1,\r\n                    inputFormatter: [formatters.inputTransactionFormatter],\r\n                    requestManager: _this._parent._requestManager,\r\n                    accounts: _this.constructor._ethAccounts || _this._ethAccounts, // is eth.accounts (necessary for wallet signing)\r\n                    defaultAccount: _this._parent.defaultAccount,\r\n                    defaultBlock: _this._parent.defaultBlock,\r\n                    extraFormatters: extraFormatters\r\n                })).createFunction();\r\n\r\n                return sendTransaction(args.options, args.callback);\r\n\r\n        }\r\n\r\n    }\r\n\r\n};\r\n\r\nmodule.exports = Contract;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}